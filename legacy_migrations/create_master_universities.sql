-- 1. Create Table
CREATE TABLE IF NOT EXISTS master_universities (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- 2. Enable RLS
ALTER TABLE master_universities ENABLE ROW LEVEL SECURITY;

-- 3. Create Policies
-- Allow Read access to everyone (Registered users, Public registration page)
CREATE POLICY "Public Read Access" ON master_universities
    FOR SELECT USING (true);

-- Allow Full Access only to Super Admin
-- Note: This assumes you have implemented Role-Based Access Control in your profiles table
-- and that Supabase auth.uid() maps correctly.
CREATE POLICY "Super Admin Write Access" ON master_universities
    FOR ALL
    USING (
        EXISTS (
            SELECT 1 FROM profiles
            WHERE profiles.id = auth.uid()
            AND profiles.role = 'superadmin'
        )
    );

-- 4. Seed Initial Data
INSERT INTO master_universities (name) VALUES
('IAIN KUDUS'),
('INSTITUT KESENIAN JAKARTA'),
('INSTITUT PERTANIAN BOGOR'),
('INSTITUT SENI INDONESIA YOGYAKARTA'),
('INSTITUT TEKNOLOGI BANDUNG'),
('INSTITUT TEKNOLOGI HARAPAN BANGSA'),
('INSTITUT TEKNOLOGI KALIMANTAN'),
('INSTITUT TEKNOLOGI NASIONAL'),
('INSTITUT TEKNOLOGI SEPULUH NOPEMBER'),
('POLITEKNIK ELEKTRONIKA NEGERI SURABAYA'),
('POLITEKNIK NEGERI BANDUNG'),
('POLITEKNIK NEGERI BATAM'),
('POLITEKNIK NEGERI MALANG'),
('POLITEKNIK NEGERI SAMARINDA'),
('POLITEKNIK NEGERI SEMARANG'),
('SEKOLAH TINGGI ILMU EKONOMI MALANGKUCECWARA'),
('SEKOLAH TINGGI ILMU EKONOMI YKPN'),
('STKIP ABDI WACANA WAMENA'),
('UNIVERSITAS AIRLANGGA'),
('UNIVERSITAS ANDALAS'),
('UNIVERSITAS ATMA JAYA YOGYAKARTA'),
('UNIVERSITAS BANGKA BELITUNG'),
('UNIVERSITAS BENGKULU'),
('UNIVERSITAS BINA NUSANTARA'),
('UNIVERSITAS BORNEO TARAKAN'),
('UNIVERSITAS BRAWIJAYA'),
('UNIVERSITAS CENDRAWASIH'),
('UNIVERSITAS DIAN NUSWANTORO'),
('UNIVERSITAS DIPONEGORO'),
('UNIVERSITAS HALU OLEO'),
('UNIVERSITAS HASANUDDIN'),
('UNIVERSITAS ISLAM BANDUNG'),
('UNIVERSITAS ISLAM MALANG'),
('UNIVERSITAS ISLAM NEGERI SUNAN AMPEL'),
('UNIVERSITAS ISLAM NEGERI SUNAN GUNUNG DJATI'),
('UNIVERSITAS ISLAM NEGERI SUNAN KALIJAGA'),
('UNIVERSITAS ISLAM NEGERI SYARIF HIDAYATULLAH'),
('UNIVERSITAS ISLAM NEGERI WALISONGO'),
('UNIVERSITAS JAMBI'),
('UNIVERSITAS JEMBER'),
('UNIVERSITAS JENDERAL ACHMAD YANI'),
('UNIVERSITAS JENDERAL SOEDIRMAN'),
('UNIVERSITAS KATOLIK INDONESIA ATMA JAYA'),
('UNIVERSITAS KATOLIK PARAHYANGAN'),
('UNIVERSITAS KATOLIK SOEGIJAPRANATA'),
('UNIVERSITAS KATOLIK WIDYA MANDALA SURABAYA'),
('UNIVERSITAS KHAIRUN'),
('UNIVERSITAS KRISTEN DUTA WACANA'),
('UNIVERSITAS KRISTEN MARANATHA'),
('UNIVERSITAS KRISTEN PAPUA'),
('UNIVERSITAS KRISTEN SATYA WACANA'),
('UNIVERSITAS KRISTEN WIRA WACANA SUMBA'),
('UNIVERSITAS LAMBUNG MANGKURAT'),
('UNIVERSITAS LAMPUNG'),
('UNIVERSITAS MA CHUNG'),
('UNIVERSITAS MATARAM'),
('UNIVERSITAS MERDEKA'),
('UNIVERSITAS MUHAMMADIYAH JEMBER'),
('UNIVERSITAS MUHAMMADIYAH KUDUS'),
('UNIVERSITAS MUHAMMADIYAH MALANG'),
('UNIVERSITAS MULAWARMAN'),
('UNIVERSITAS MURIA KUDUS'),
('UNIVERSITAS MUSAMUS MERAUKE'),
('UNIVERSITAS MUSLIM INDONESIA'),
('UNIVERSITAS NAHDATUL ULAMA'),
('UNIVERSITAS NASIONAL'),
('UNIVERSITAS NASIONAL KARANGTURI SEMARANG'),
('UNIVERSITAS NEGERI GORONTALO'),
('UNIVERSITAS NEGERI JAKARTA'),
('UNIVERSITAS NEGERI MAKASSAR'),
('UNIVERSITAS NEGERI MALANG'),
('UNIVERSITAS NEGERI PAPUA'),
('UNIVERSITAS NEGERI SEBELAS MARET'),
('UNIVERSITAS NEGERI SEMARANG'),
('UNIVERSITAS NEGERI YOGYAKARTA'),
('UNIVERSITAS NUSA CENDANA'),
('UNIVERSITAS PADJADJARAN'),
('UNIVERSITAS PALANGKARAYA'),
('UNIVERSITAS PARAMADINA'),
('UNIVERSITAS PASUNDAN'),
('UNIVERSITAS PATTIMURA'),
('UNIVERSITAS PEMBANGUNAN NASIONAL VETERAN JAWA TIMUR'),
('UNIVERSITAS PEMBANGUNAN NASIONAL VETERAN YOGYAKARTA'),
('UNIVERSITAS PENDIDIKAN INDONESIA'),
('UNIVERSITAS PROF. DR. MOESTOPO (BERAGAMA)'),
('UNIVERSITAS RIAU'),
('UNIVERSITAS SAM RATULANGI'),
('UNIVERSITAS SANATA DHARMA'),
('UNIVERSITAS SEMARANG'),
('UNIVERSITAS SILIWANGI'),
('UNIVERSITAS SRIWIJAYA'),
('UNIVERSITAS SULAWESI BARAT'),
('UNIVERSITAS SULTAN AGENG TIRTAYASA'),
('UNIVERSITAS SUMATERA UTARA'),
('UNIVERSITAS SURABAYA'),
('UNIVERSITAS SWADAYA GUNUNG JATI'),
('UNIVERSITAS SYIAH KUALA'),
('UNIVERSITAS TADULAKO'),
('UNIVERSITAS TANJUNGPURA'),
('UNIVERSITAS TARUMANAGARA'),
('UNIVERSITAS TRUNOJOYO'),
('UNIVERSITAS UDAYANA'),
('UNIVERSITAS WARMADEWA'),
('UNIVERSITAS WIDYATAMA')
ON CONFLICT (name) DO NOTHING;
